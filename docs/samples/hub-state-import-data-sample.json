{
  "configurations": [
    {
      "id": "my_config",
      "labels": null,
      "content": {
        "deviceContent": {
          "properties.desired.awesome": 3
        }
      },
      "targetCondition": "tags.environment='test'",
      "priority": 10,
      "systemMetrics": {
        "results": {
          "targetedCount": 0,
          "appliedCount": 0
        },
        "queries": {
          "targetedCount": "select deviceId from devices where tags.environment='test'",
          "appliedCount": "select deviceId from devices where configurations.[[my_config]].status = 'Applied'"
        }
      },
      "metrics": {
        "results": {},
        "queries": {}
      }
    },
    {
      "id": "my_config2",
      "labels": null,
      "content": {
        "deviceContent": {
          "properties.desired.prop2": 5
        }
      },
      "targetCondition": "*",
      "priority": 7,
      "systemMetrics": {
        "results": {
          "targetedCount": 7,
          "appliedCount": 7
        },
        "queries": {
          "targetedCount": "select deviceId from devices",
          "appliedCount": "select deviceId from devices where configurations.[[my_config2]].status = 'Applied'"
        }
      },
      "metrics": {
        "results": {},
        "queries": {}
      }
    }
  ],
  "edgeDeployments": [
    {
      "id": "mydeployment1",
      "schemaVersion": "2.0",
      "labels": null,
      "content": {
        "modulesContent": {
          "$edgeAgent": {
            "properties.desired": {
              "schemaVersion": "1.1",
              "runtime": {
                "type": "docker",
                "settings": {
                  "minDockerVersion": "v1.25",
                  "loggingOptions": "",
                  "registryCredentials": {
                    "ContosoRegistry": {
                      "username": "myacr",
                      "password": "<password>",
                      "address": "myacr.azurecr.io"
                    }
                  }
                }
              },
              "systemModules": {
                "edgeAgent": {
                  "type": "docker",
                  "settings": {
                    "image": "mcr.microsoft.com/azureiotedge-agent:1.0",
                    "createOptions": ""
                  }
                },
                "edgeHub": {
                  "type": "docker",
                  "status": "running",
                  "restartPolicy": "always",
                  "startupOrder": 0,
                  "settings": {
                    "image": "mcr.microsoft.com/azureiotedge-hub:1.0",
                    "createOptions": "{\"HostConfig\":{\"PortBindings\":{\"443/tcp\":[{\"HostPort\":\"443\"}],\"5671/tcp\":[{\"HostPort\":\"5671\"}],\"8883/tcp\":[{\"HostPort\":\"8883\"}]}}}"
                  }
                }
              },
              "modules": {
                "SimulatedTemperatureSensor": {
                  "version": "1.0",
                  "type": "docker",
                  "status": "running",
                  "restartPolicy": "always",
                  "startupOrder": 2,
                  "settings": {
                    "image": "mcr.microsoft.com/azureiotedge-simulated-temperature-sensor:1.0",
                    "createOptions": "{}"
                  }
                },
                "filtermodule": {
                  "version": "1.0",
                  "type": "docker",
                  "status": "running",
                  "restartPolicy": "always",
                  "startupOrder": 1,
                  "env": {
                    "tempLimit": {
                      "value": "100"
                    }
                  },
                  "settings": {
                    "image": "myacr.azurecr.io/filtermodule:latest",
                    "createOptions": "{}"
                  }
                }
              }
            }
          },
          "$edgeHub": {
            "properties.desired": {
              "schemaVersion": "1.2",
              "routes": {
                "sensorToFilter": {
                  "route": "FROM /messages/modules/SimulatedTemperatureSensor/outputs/temperatureOutput INTO BrokeredEndpoint(\"/modules/filtermodule/inputs/input1\")",
                  "priority": 0,
                  "timeToLiveSecs": 1800
                },
                "filterToIoTHub": {
                  "route": "FROM /messages/modules/filtermodule/outputs/output1 INTO $upstream",
                  "priority": 1,
                  "timeToLiveSecs": 1800
                }
              },
              "storeAndForwardConfiguration": {
                "timeToLiveSecs": 100
              }
            }
          }
        }
      },
      "targetCondition": "",
      "createdTimeUtc": "2022-07-22T22:13:23.289712Z",
      "lastUpdatedTimeUtc": "2022-07-22T22:13:23.289712Z",
      "priority": 1,
      "systemMetrics": {
        "results": {
          "appliedCount": 0,
          "reportedSuccessfulCount": 0,
          "reportedFailedCount": 0,
          "targetedCount": 0
        },
        "queries": {
          "targetedCount": "",
          "appliedCount": "select deviceId from devices.modules where moduleId = '$edgeAgent' and configurations.[[mydeployment1]].status = 'Applied'",
          "reportedSuccessfulCount": "select deviceId from devices.modules where moduleId = '$edgeAgent' and configurations.[[mydeployment1]].status = 'Applied' and properties.desired.$version = properties.reported.lastDesiredVersion and properties.reported.lastDesiredStatus.code = 200",
          "reportedFailedCount": "select deviceId from devices.modules where moduleId = '$edgeAgent' and configurations.[[mydeployment1]].status = 'Applied' and properties.desired.$version = properties.reported.lastDesiredVersion and properties.reported.lastDesiredStatus.code != 200"
        }
      },
      "metrics": {
        "results": {},
        "queries": {
          "mymetric": "SELECT deviceId from devices where properties.reported.lastDesiredStatus.code = 200"
        }
      },
      "etag": "MQ=="
    },
    {
      "id": "mylayereddeployment1",
      "schemaVersion": "2.0",
      "labels": null,
      "content": {
        "modulesContent": {
          "$edgeAgent": {
            "properties.desired.modules.mymodule0": {
              "settings": {
                "image": "myimageuri",
                "createOptions": "{\"MemorySwap\":0}"
              },
              "type": "docker",
              "env": {
                "envvar0": {
                  "value": "envvarval0"
                }
              },
              "status": "running",
              "restartPolicy": "always",
              "version": "1.0"
            }
          },
          "$edgeHub": {
            "properties.desired.routes.route0": "from /messages/* INTO $upstream"
          },
          "mymodule0": {
            "properties.desired.settings": {
              "prop0": "val0"
            }
          }
        }
      },
      "targetCondition": "",
      "createdTimeUtc": "2022-07-22T22:16:02.3200653Z",
      "lastUpdatedTimeUtc": "2022-07-22T22:16:02.3200653Z",
      "priority": 1,
      "systemMetrics": {
        "results": {
          "appliedCount": 0,
          "reportedSuccessfulCount": 0,
          "reportedFailedCount": 0,
          "targetedCount": 0
        },
        "queries": {
          "targetedCount": "",
          "appliedCount": "select deviceId from devices.modules where moduleId = '$edgeAgent' and configurations.[[mylayereddeployment1]].status = 'Applied'",
          "reportedSuccessfulCount": "select deviceId from devices.modules where moduleId = '$edgeAgent' and configurations.[[mylayereddeployment1]].status = 'Applied' and properties.desired.$version = properties.reported.lastDesiredVersion and properties.reported.lastDesiredStatus.code = 200",
          "reportedFailedCount": "select deviceId from devices.modules where moduleId = '$edgeAgent' and configurations.[[mylayereddeployment1]].status = 'Applied' and properties.desired.$version = properties.reported.lastDesiredVersion and properties.reported.lastDesiredStatus.code != 200"
        }
      },
      "metrics": {
        "results": {},
        "queries": {
          "mymetric": "SELECT deviceId FROM devices WHERE properties.reported.lastDesiredStatus.code = 200"
        }
      },
      "etag": "MQ=="
    }
  ],
  "devices": {
    "identities": [
      {
        "deviceId": "device1-child",
        "status": "enabled",
        "connectionState": "Disconnected",
        "authenticationType": "sas",
        "x509Thumbprint": {
          "primaryThumbprint": null,
          "secondaryThumbprint": null
        },
        "properties": {
          "desired": {
            "prop2": 5
          }
        },
        "capabilities": {
          "iotEdge": false
        },
        "symmetricKey": {
          "primaryKey": "mock_key",
          "secondaryKey": "mock_key"
        }
      },
      {
        "deviceId": "edge-parent1",
        "status": "enabled",
        "connectionState": "Disconnected",
        "authenticationType": "sas",
        "x509Thumbprint": {
          "primaryThumbprint": null,
          "secondaryThumbprint": null
        },
        "properties": {
          "desired": {
            "prop2": 5
          }
        },
        "capabilities": {
          "iotEdge": true
        },
        "symmetricKey": {
          "primaryKey": "mock_key",
          "secondaryKey": "mock_key"
        }
      },
      {
        "deviceId": "edge-parent2",
        "status": "enabled",
        "connectionState": "Disconnected",
        "authenticationType": "sas",
        "x509Thumbprint": {
          "primaryThumbprint": null,
          "secondaryThumbprint": null
        },
        "properties": {
          "desired": {
            "prop2": 5
          }
        },
        "capabilities": {
          "iotEdge": true
        },
        "symmetricKey": {
          "primaryKey": "mock_key",
          "secondaryKey": "mock_key"
        }
      },
      {
        "deviceId": "device2",
        "status": "enabled",
        "connectionState": "Disconnected",
        "authenticationType": "selfSigned",
        "x509Thumbprint": {
          "primaryThumbprint": "085836B09D1272B03F21FDFA8DC055D658C5AF14",
          "secondaryThumbprint": null
        },
        "tags": {
          "deviceType": "Type1, Type2, Type3",
          "example": "val"
        },
        "properties": {
          "desired": {
            "prop2": 5
          }
        },
        "capabilities": {
          "iotEdge": true
        }
      },
      {
        "deviceId": "device2-child",
        "status": "enabled",
        "connectionState": "Disconnected",
        "authenticationType": "sas",
        "x509Thumbprint": {
          "primaryThumbprint": null,
          "secondaryThumbprint": null
        },
        "properties": {
          "desired": {
            "prop2": 5
          }
        },
        "capabilities": {
          "iotEdge": false
        },
        "symmetricKey": {
          "primaryKey": "mock_key",
          "secondaryKey": "mock_key"
        }
      },
      {
        "deviceId": "simDevice",
        "status": "enabled",
        "connectionState": "Disconnected",
        "authenticationType": "sas",
        "x509Thumbprint": {
          "primaryThumbprint": null,
          "secondaryThumbprint": null
        },
        "tags": {
          "deviceType": "Type1, Type2, Type3"
        },
        "properties": {
          "desired": {
            "property1": 24,
            "prop2": 5
          }
        },
        "capabilities": {
          "iotEdge": false
        },
        "symmetricKey": {
          "primaryKey": "mock_key",
          "secondaryKey": "mock_key"
        }
      },
      {
        "deviceId": "device3",
        "status": "enabled",
        "connectionState": "Disconnected",
        "authenticationType": "certificateAuthority",
        "x509Thumbprint": {
          "primaryThumbprint": null,
          "secondaryThumbprint": null
        },
        "tags": {
          "deviceType": "Type1, Type2, Type3"
        },
        "properties": {
          "desired": {
            "prop2": 5
          }
        },
        "capabilities": {
          "iotEdge": false
        }
      }
    ],
    "children": {
      "edge-parent1": [
        "device1-child",
        "edge-parent2"
      ],
      "edge-parent2": [
        "device2-child"
      ],
      "device2": [
        "edge-parent1",
        "simDevice"
      ]
    }
  },
  "modules": {
    "device1-child": [],
    "edge-parent1": [],
    "edge-parent2": [],
    "device2": [
      [
        {
          "additional_properties": {},
          "module_id": "module2",
          "managed_by": null,
          "device_id": "device2",
          "generation_id": "637920587461553088",
          "connection_state": "Disconnected",
          "authentication": {
            "symmetricKey": {
              "primaryKey": null,
              "secondaryKey": null
            },
            "x509Thumbprint": {
              "primaryThumbprint": null,
              "secondaryThumbprint": null
            },
            "type": "certificateAuthority"
          }
        },
        {
          "deviceId": "device2",
          "moduleId": "module2",
          "status": "enabled",
          "connectionState": "Disconnected",
          "authenticationType": "certificateAuthority",
          "x509Thumbprint": {
            "primaryThumbprint": null,
            "secondaryThumbprint": null
          },
          "modelId": "",
          "tags": {
            "timeZone": "western"
          },
          "properties": {
            "desired": {
              "conditions": {
                "temperature": {
                  "warning": 70,
                  "critical": 100
                }
              }
            }
          }
        }
      ]
    ],
    "device2-child": [],
    "simDevice": [
      [
        {
          "additional_properties": {},
          "module_id": "module1",
          "managed_by": null,
          "device_id": "simDevice",
          "generation_id": "637907447770121687",
          "connection_state": "Disconnected",
          "authentication": {
            "symmetricKey": {
              "primaryKey": "mock_key",
              "secondaryKey": "mock_key"
            },
            "x509Thumbprint": {
              "primaryThumbprint": null,
              "secondaryThumbprint": null
            },
            "type": "sas"
          }
        },
        {
          "deviceId": "simDevice",
          "moduleId": "module1",
          "status": "enabled",
          "connectionState": "Disconnected",
          "authenticationType": "sas",
          "x509Thumbprint": {
            "primaryThumbprint": null,
            "secondaryThumbprint": null
          },
          "modelId": "",
          "properties": {
            "desired": {
              "property2": 25
            }
          }
        }
      ],
      [
        {
          "additional_properties": {},
          "module_id": "simModule",
          "managed_by": null,
          "device_id": "simDevice",
          "generation_id": "637920585539407125",
          "connection_state": "Disconnected",
          "authentication": {
            "symmetricKey": {
              "primaryKey": "mock_key",
              "secondaryKey": "mock_key"
            },
            "x509Thumbprint": {
              "primaryThumbprint": null,
              "secondaryThumbprint": null
            },
            "type": "sas"
          }
        },
        {
          "deviceId": "simDevice",
          "moduleId": "simModule",
          "status": "enabled",
          "connectionState": "Disconnected",
          "authenticationType": "sas",
          "x509Thumbprint": {
            "primaryThumbprint": null,
            "secondaryThumbprint": null
          },
          "modelId": "",
          "properties": {
            "desired": {
              "color": "green",
              "shape": "square"
            }
          }
        }
      ]
    ],
    "device3": [
      [
        {
          "additional_properties": {},
          "module_id": "module1",
          "managed_by": null,
          "device_id": "device3",
          "generation_id": "637937846362414376",
          "connection_state": "Disconnected",
          "authentication": {
            "symmetricKey": {
              "primaryKey": "mock_key",
              "secondaryKey": "mock_key"
            },
            "x509Thumbprint": {
              "primaryThumbprint": null,
              "secondaryThumbprint": null
            },
            "type": "sas"
          }
        },
        {
          "deviceId": "device3",
          "moduleId": "module1",
          "status": "enabled",
          "connectionState": "Disconnected",
          "authenticationType": "sas",
          "x509Thumbprint": {
            "primaryThumbprint": null,
            "secondaryThumbprint": null
          },
          "modelId": "",
          "properties": {
            "desired": {
              "magic": 3
            }
          }
        }
      ]
    ]
  }
}