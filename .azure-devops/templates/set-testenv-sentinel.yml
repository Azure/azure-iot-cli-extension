steps:
  - task: PythonScript@0
    displayName : 'Set test envs with sentinel values'
    name: 'setTestEnvSentinel'
    inputs:
      scriptSource: 'inline'
      script: |
        # This task is in place to get around DevOps pipelines env var naming rules which would require
        # application code changes.
        import os
        envvars = {
            "azext_iot_central_app_id": os.environ["AZEXT_IOT_CENTRAL_APP_ID"],
        }
        f = open("./pytest.ini", "w+")
        f.write("[pytest]\n")
        f.write("junit_family = xunit1\n")
        f.write("env = \n")
        envvars_sentinel = ["  {}={}\n".format(key, val) for key, val in envvars.items()]
        f.writelines(envvars_sentinel)
        print(envvars_sentinel)
        f.close()
    
    env:
      AZEXT_IOT_CENTRAL_APP_ID: $(azext_iot_central_app_id)
