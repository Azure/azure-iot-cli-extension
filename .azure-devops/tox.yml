trigger: none
pr: none

pool:
  vmImage: 'ubuntu-latest'
jobs:
- job: run
  strategy:
    matrix:
      'linters':
        python: '3.7'
        toxEnvStr: 'lint'
        desc: 'Flake8, Pylint'
      'python 3.7 tests, min CLI':
        python: '3.7'
        toxEnvStr: 'py3.7-azmin-unit'
        desc: 'python 3.7 tests, min CLI'
      'python 3.7 tests, current CLI':
        python: '3.7'
        toxEnvStr: 'py3.7-azcur-unit'
        desc: 'Python 3.7 tests, current CLI'
      'python 3.8 tests, min CLI':
        python: '3.8'
        toxEnvStr: 'py3.8-azmin-unit'
        desc: 'python 3.8 tests, min CLI'
      'python 3.8 tests, current CLI':
        python: '3.8'
        toxEnvStr: 'py3.8-azcur-unit'
        desc: 'Python 3.8 tests, current CLI'
      'python 3.9 tests, min CLI':
        python: '3.9'
        toxEnvStr: 'py3.9-azmin-unit'
        desc: 'python 3.9 tests, min CLI'
      'python 3.9 tests, current CLI':
        python: '3.9'
        toxEnvStr: 'py3.9-azcur-unit'
        desc: 'Python 3.9 tests, current CLI'
      'python 3.10 tests, min CLI':
        python: '3.10'
        toxEnvStr: 'py3.10-azmin-unit'
        desc: 'Python 3.10 tests, min CLI'
      'python 3.10 tests, current CLI':
        python: '3.10'
        toxEnvStr: 'py3.10-azcur-unit'
        desc: 'Python 3.10 tests, current CLI'
  steps:
  - template: templates/clone-cli-repo.yml
  - template: templates/setup-tox.yml
  - template: templates/set-testenv-sentinel.yml
  - task: UsePythonVersion@0
    inputs:
      versionSpec: $(python)
      architecture: 'x64'
    displayName: 'Use cached Python $(python) for tests.'

  - script: $(pyTools.pythonLocation)/bin/tox -e "$(toxEnvStr)" -vv
    displayName: $(desc)
    env:
        AZEXT_IOT_TESTRG: "test"